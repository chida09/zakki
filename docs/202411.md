# 20241105

## jest.fn()、mockReturnValueなど
- `jest.fn()`
  - 関数がどのように呼び出されたか、何回呼び出されたかなどのテストを行う場合に利用する
  - jest.fn()はundefinedを返すモック関数
  - モック関数の戻り値を指定するには、`jest.fn().mockImplementation`を利用する
- `jest.fn().mockImplementation`
  - ex: `jest.fn().mockImplementation(() => 1);`
- `jest.fn().mockReturnValue`
  - `jest.fn().mockImplementation`のシンタックスシュガー
  - ex: `jest.fn().mockReturnValue(1);`
- `jest.fn().mockReturnValueOnce`
  - 関数が呼び出されるたびに異なる戻り値を返したい場合に使う
  - 以下のようにメソッドチェーンで繋げることができるようになる
  - ex: `jest.fn().mockReturnValueOnce(1).mockReturnValueOnce(50)`
- `jest.fn().mockResolvedValue(value)`
  - `jest.fn().mockImplementation(() => Promise.resolve(value));`のシンタックスシュガー
- `jest.spyOn()`
  - オブジェクトの特定の関数をモック化する
- `jest.mock()`
  - axiosなどのモジュールをモック化する
  - jest.mock()はdescribeの外に書かないと機能しない
- `jest.requireActual`
  - モジュールの一部だけをモックする


参考
- https://archive.jestjs.io/docs/ja/22.x/mock-function-api
- https://note.shiftinc.jp/n/n9bea99937da4

## `type predicates`
- TypeScript 5.4以前ではユーザー定義型ガードを使う際には型述語(`value is types`)が必要だった
- TypeScript 5.5からは不要になる

対応前
```ts
messages.filter((message) => {
  return !!message.comment?.id
}).map((message) => ({
  commentId: message.comment?.id // filterで絞り込みしても?は必要
}))
```

対応後
```ts
messages.filter(
  (message): message is typeof message & { comment: { id: number };} => {
   return !!message.comment?.id
  }
).map((message) => ({
  commentId: message.comment.id
}))
```

- https://zenn.dev/ubie_dev/articles/ts-infer-type-predicates
- https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates

# 20241106

## package.json

- package.json: インストールする package の範囲を記述します
- package.lock.json: 実際にインストールされている package のバージョン（などの）情報が記載されます
- つまり、package.jsonを`~1.2.0`と書けば、package.lock.jsonではpatchバージョンだけ上がる
- チルダの場合、`~1.2.1`のようにpackage.jsonをインクリメントする必要はない

# 20241107

URLのバリデーションで空文字を許容したい時

```ts
const schema = z.object({
  src: z.string().url().or(z.string().length(0)),
})
```

# 20241115

comboboxで、typeはenumの時nullをBEに送信する例

```html
<select>
  <option />
  <option>A</option>
  <option>B</option>
  <option>C</option>
</select>
```

```ts
/**
 * z.enum(['A', 'B', 'C', ''])で空のoptionを許容
 * nullable()は初期値を想定
*/
const schema = z.object({
  dataType: z.enum(['A', 'B', 'C', '']).nullable()
})
```

```ts
const handleSubmit = _handleSubmit((data) => {
  dataType: data.type || null
})
```

## 20241117
- GHAのComposite Action(複合アクション)とは、よくある処理をまとめ、再利用性・メンテナンス性・一貫性を高めるやつ
- Node.jsのセットアップなどで利用できる
- [Composite Action実践ガイド：GitHub Actionsのメンテナンス性を高める技法
](https://zenn.dev/tmknom/books/pragmatic-composite-action/viewer/introduction)

## 20241119

Sentry.initのオプションについて
- enabled: このSDKがSentryにイベントを送信するかどうかを指定します。 デフォルトはtrue
- replaysOnErrorSampleRate: エラーが発生する1分前からセッションの終了までを計測する比率です。エラーが頻発する環境では計測頻度と料金で適切な値を見積もる必要がありますが、エラーが発生しても取得できずに原因を探れないと困るので通常は1に設定するのが良いと考えています。
- replaysSessionSampleRate: エラーの有無に関わらずユーザーのセッション全体に渡って計測する比率です。セッションはユーザーが非アクティブな状態を15分続けるか、60分経過した時点で終了します。
- tracesSampleRate: すべてのトランザクションの一様なサンプルレートを0から1の間の数値に設定する(例えば、トランザクションの20%を送信するには、tracesSampleRateを0.2に設定する)。
- integrations
  - reactRouterV6BrowserTracingIntegration
  - React Router ライブラリを使用してページ読み込みと関連するリクエストに関するデータを収集する
  - https://docs.sentry.io/platforms/javascript/guides/react/features/react-router/#usage-with-routes--component

参考
- https://qiita.com/KokiSakano/items/17c0cd6d3ad6921b060a
